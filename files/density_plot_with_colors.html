<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Density Plot</title>
    <script src="https://cdn.plot.ly/plotly-2.16.1.min.js"></script>
</head>
<body>
    <div id="plot" style="width:100%; height:600px;"></div>
    <label for="colormap">Choose a colormap:</label>
    <select id="colormap" onchange="updateColormap()"></select>

    <script>
        // Load the JSON file dynamically for density data
        fetch('density_data.json')
            .then(response => response.json())
            .then(densityData => {
                const x_domain = densityData.x_domain;
                const y_domain = densityData.y_domain;
                const f_density = densityData.f_density;

                // Create the initial plot
                const initialColormap = 'batlow'; // Default colormap
                Plotly.newPlot('plot', [{
                    z: f_density,
                    x: x_domain,
                    y: y_domain,
                    type: 'surface',
                    colorscale: initialColormap
                }], {
                    title: "Interactive Density Plot",
                    scene: {
                        xaxis: { title: "x", range: [Math.min(...x_domain), Math.max(...x_domain)] },
                        yaxis: { title: "y", range: [Math.min(...y_domain), Math.max(...y_domain)] },
                        zaxis: { title: "Density", range: [-0.5, 2] },
                        aspectmode: "cube"
                    }
                });

                // Load Crameri color scales
                fetch('cmcrameri_colors.json')
                    .then(response => response.json())
                    .then(colorScales => {
                        const colormapSelect = document.getElementById('colormap');
                        // Populate dropdown with color map names
                        Object.keys(colorScales).forEach(cmapName => {
                            const option = document.createElement('option');
                            option.value = cmapName;
                            option.textContent = cmapName.charAt(0).toUpperCase() + cmapName.slice(1);
                            colormapSelect.appendChild(option);
                        });

                        // Update colormap dynamically on selection
                        colormapSelect.onchange = function () {
                            const selectedColormap = this.value;
                            const colorscale = colorScales[selectedColormap];
                            Plotly.update('plot', {}, { colorscale: [colorscale] }, 0); // Explicitly reset the colorscale
                        };
                    })
                    .catch(error => console.error('Error loading color scales:', error));
            })
            .catch(error => console.error('Error loading density data:', error));
    </script>
</body>
</html>
