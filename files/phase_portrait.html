<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Phase Portrait</title>
    <script src="https://cdn.plot.ly/plotly-2.16.1.min.js"></script>
</head>
<body>
    <h1>Interactive Phase Portrait</h1>
    <p>
        This interactive phase portrait is based on the nonlinear system:
        <br>
        \[
        \dot{x}_1 = \mu x_1, \quad \dot{x}_2 = \lambda (x_2 - x_1^2)
        \]
    </p>
    <div id="plot" style="width: 100%; height: 600px;"></div>

    <script>
        // Parameters for the system
        const mu = -0.1;  // Growth/decay rate
        const lambda = -1; // Convergence rate

        // Define the dynamical system
        function dynamicalSystem(t, y) {
            const [x1, x2] = y;
            return [
                mu * x1,
                lambda * (x2 - x1 ** 2)
            ];
        }

        // Solve the system using a simple Euler integration
        function solveTrajectory(initial, tMax, dt = 0.01) {
            let trajectory = [];
            let [x1, x2] = initial;
            for (let t = 0; t <= tMax; t += dt) {
                trajectory.push([x1, x2]);
                let [dx1, dx2] = dynamicalSystem(t, [x1, x2]);
                x1 += dx1 * dt;
                x2 += dx2 * dt;
            }
            return trajectory;
        }

        // Generate the phase portrait
        let x1 = Array.from({ length: 20 }, (_, i) => -2 + i * 0.2);
        let x2 = Array.from({ length: 20 }, (_, i) => -2 + i * 0.2);
        let vectors = [];
        for (let i of x1) {
            for (let j of x2) {
                let [dx1, dx2] = dynamicalSystem(0, [i, j]);
                vectors.push({ x: i, y: j, u: dx1, v: dx2 });
            }
        }

        // Plot the phase portrait
        let phasePortrait = {
            x: vectors.map(v => v.x),
            y: vectors.map(v => v.y),
            mode: 'markers',
            marker: { size: 3, color: 'blue' },
            name: 'Phase Portrait',
            type: 'scatter'
        };

        let layout = {
            title: "Interactive Phase Portrait",
            xaxis: { title: "x₁" },
            yaxis: { title: "x₂" }
        };

        let data = [phasePortrait];

        Plotly.newPlot('plot', data, layout);

        // Add a click event to the plot
        let trajectories = [];
        document.getElementById('plot').on('plotly_click', function(data) {
            let clickPoint = data.points[0];
            let initial = [clickPoint.x, clickPoint.y];
            let trajectory = solveTrajectory(initial, 20);

            // Extract trajectory coordinates
            let trajectoryTrace = {
                x: trajectory.map(point => point[0]),
                y: trajectory.map(point => point[1]),
                mode: 'lines',
                name: `Trajectory (${clickPoint.x.toFixed(2)}, ${clickPoint.y.toFixed(2)})`
            };

            trajectories.push(trajectoryTrace);
            Plotly.addTraces('plot', trajectoryTrace);
        });
    </script>
</body>
</html>
